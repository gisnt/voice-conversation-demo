C51 COMPILER V9.00   MAIN                                                                  11/14/2021 10:30:08 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\obj\main.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE ..\code\main.c BROWSE INCDIR(..\code;..\user) DEBUG OBJECTEXTEND PRINT(.\ma
                    -in.lst) OBJECT(..\obj\main.obj)

line level    source

   1          /******************************************************
   2          **  ¹¤³ÌÃû³Æ£ºUNV-01ÓïÒôÊ¶±ðÄ£¿éÇý¶¯³ÌÐò
   3          **      CPU: STC11L08XE
   4          **      ¾§Õñ£º22.1184MHZ
   5          **      ²¨ÌØÂÊ£º9600 bit/S
   6          **      ÅäÌ×²úÆ·ÐÅÏ¢£ºUNV-LD3320+STC11ÓïÒôÊ¶±ð¿ª·¢°å
   7          **  ËµÃ÷£º¿ÚÁîÄ£Ê½£º ¼´Ã¿´ÎÊ¶±ðÊ±¶¼ÐèÒªËµ¡°°¢À­ÉñµÆ¡±Õâ¸ö¿ÚÁî £¬²ÅÄÜ¹»½øÐÐÏÂÒ»¼¶µÄÊ¶±ð
   8          ***************************/
   9          #include "config.h"
  10          /************************************************************************************/
  11          //      nAsrStatus ÓÃÀ´ÔÚmainÖ÷³ÌÐòÖÐ±íÊ¾³ÌÐòÔËÐÐµÄ×´Ì¬£¬²»ÊÇLD3320Ð¾Æ¬ÄÚ²¿µÄ×´Ì¬¼Ä´æÆ÷
  12          //      LD_ASR_NONE:            ±íÊ¾Ã»ÓÐÔÚ×÷ASRÊ¶±ð
  13          //      LD_ASR_RUNING£º         ±íÊ¾LD3320ÕýÔÚ×÷ASRÊ¶±ðÖÐ
  14          //      LD_ASR_FOUNDOK:         ±íÊ¾Ò»´ÎÊ¶±ðÁ÷³Ì½áÊøºó£¬ÓÐÒ»¸öÊ¶±ð½á¹û
  15          //      LD_ASR_FOUNDZERO:       ±íÊ¾Ò»´ÎÊ¶±ðÁ÷³Ì½áÊøºó£¬Ã»ÓÐÊ¶±ð½á¹û
  16          //      LD_ASR_ERROR:           ±íÊ¾Ò»´ÎÊ¶±ðÁ÷³ÌÖÐLD3320Ð¾Æ¬ÄÚ²¿³öÏÖ²»ÕýÈ·µÄ×´Ì¬
  17          /***********************************************************************************/
  18          uint8 idata nAsrStatus=0;       
  19          void MCU_init(); 
  20          void ProcessInt0(); //Ê¶±ð´¦Àíº¯Êý
  21          void delay(unsigned long uldata);
  22          void User_handle(uint8 dat);//ÓÃ»§Ö´ÐÐ²Ù×÷º¯Êý
  23          void Delay200ms();
  24          void Led_test(void);//µ¥Æ¬»ú¹¤×÷Ö¸Ê¾
  25          uint8_t G0_flag=DISABLE;//ÔËÐÐ±êÖ¾£¬ENABLE:ÔËÐÐ¡£DISABLE:½ûÖ¹ÔËÐÐ 
  26          sbit LED=P4^2;//ÐÅºÅÖ¸Ê¾µÆ
  27          sbit P10=P1^0;
  28          sbit P11=P1^1;
  29          sbit P12=P1^2;
  30          sbit P13=P1^3;
  31          sbit P14=P1^4;
  32          sbit P15=P1^5;
  33          sbit P16=P1^6;
  34          sbit P17=P1^7;
  35          /***********************************************************
  36          * Ãû    ³Æ£º void  main(void)
  37          * ¹¦    ÄÜ£º Ö÷º¯Êý     ³ÌÐòÈë¿Ú
  38          * Èë¿Ú²ÎÊý£º  
  39          * ³ö¿Ú²ÎÊý£º
  40          * Ëµ    Ã÷£º                                     
  41          * µ÷ÓÃ·½·¨£º 
  42          **********************************************************/ 
  43          void  main(void)
  44          {
  45   1              uint8 idata nAsrRes;
  46   1              uint8 i=0;
  47   1              
  48   1              MCU_init();
  49   1              LD_Reset();
  50   1              UartIni(); /*´®¿Ú³õÊ¼»¯*/
  51   1              nAsrStatus = LD_ASR_NONE;               //      ³õÊ¼×´Ì¬£ºÃ»ÓÐÔÚ×÷ASR
  52   1              #ifdef TEST     
  53   1              SYN_FrameInfo(2, "[v5][m5][t4]Ö÷ÈËÄãºÃ£¬ÎÒ»ØÀ´ÁË¡£");
  54   1              
C51 COMPILER V9.00   MAIN                                                                  11/14/2021 10:30:08 PAGE 2   

  55   1              Led_test();
  56   1              #endif
  57   1      
  58   1              while(1)
  59   1              {
  60   2                      switch(nAsrStatus)
  61   2                      {
  62   3                              case LD_ASR_RUNING:
  63   3                              case LD_ASR_ERROR:              
  64   3                                      break;
  65   3                              case LD_ASR_NONE:
  66   3                              {
  67   4                                      nAsrStatus=LD_ASR_RUNING;
  68   4                                      if (RunASR()==0)        /*      Æô¶¯Ò»´ÎASRÊ¶±ðÁ÷³Ì£ºASR³õÊ¼»¯£¬ASRÌí¼Ó¹Ø¼ü´ÊÓï£¬Æô¶¯ASRÔËËã*/
  69   4                                      {
  70   5                                              nAsrStatus = LD_ASR_ERROR;
  71   5                                      }
  72   4                                      break;
  73   4                              }
  74   3                              case LD_ASR_FOUNDOK: /* Ò»´ÎASRÊ¶±ðÁ÷³Ì½áÊø£¬È¥È¡ASRÊ¶±ð½á¹û*/
  75   3                              {                               
  76   4                                      nAsrRes = LD_GetResult();               /*»ñÈ¡½á¹û*/
  77   4                                      User_handle(nAsrRes);//ÓÃ»§Ö´ÐÐº¯Êý 
  78   4                                      nAsrStatus = LD_ASR_NONE;
  79   4                                      break;
  80   4                              }
  81   3                              case LD_ASR_FOUNDZERO:
  82   3                              default:
  83   3                              {
  84   4                                      nAsrStatus = LD_ASR_NONE;
  85   4                                      break;
  86   4                              }
  87   3                      }// switch                              
  88   2              }// while
  89   1      
  90   1      }
  91          /***********************************************************
  92          * Ãû    ³Æ£º     LEDµÆ²âÊÔ
  93          * ¹¦    ÄÜ£º µ¥Æ¬»úÊÇ·ñ¹¤×÷Ö¸Ê¾
  94          * Èë¿Ú²ÎÊý£º ÎÞ 
  95          * ³ö¿Ú²ÎÊý£ºÎÞ
  96          * Ëµ    Ã÷£º                                     
  97          **********************************************************/
  98          void Led_test(void)
  99          {
 100   1              Delay200ms();
 101   1              Delay200ms();
 102   1              LED=~ LED;
 103   1              Delay200ms();
 104   1              LED=~ LED;
 105   1              Delay200ms();
 106   1              LED=~ LED;
 107   1              Delay200ms();
 108   1              LED=~ LED;
 109   1      }
 110          /***********************************************************
 111          * Ãû    ³Æ£º void MCU_init()
 112          * ¹¦    ÄÜ£º µ¥Æ¬»ú³õÊ¼»¯
 113          * Èë¿Ú²ÎÊý£º  
 114          * ³ö¿Ú²ÎÊý£º
 115          * Ëµ    Ã÷£º                                     
 116          * µ÷ÓÃ·½·¨£º 
C51 COMPILER V9.00   MAIN                                                                  11/14/2021 10:30:08 PAGE 3   

 117          **********************************************************/ 
 118          void MCU_init()
 119          {
 120   1              P0 = 0xff;
 121   1              P1 = 0xff;
 122   1              P2 = 0xff;
 123   1              P3 = 0xff;
 124   1              P4 = 0xff;
 125   1              P1M1&=0X00;
 126   1              P1M0|=0XFF;
 127   1              P10=0;P11=0;P12=0;P13=0;
 128   1              LD_MODE = 0;            //      ÉèÖÃMD¹Ü½ÅÎªµÍ£¬²¢ÐÐÄ£Ê½¶ÁÐ´
 129   1              IE0=1;
 130   1              EX0=1;
 131   1              EA=1;
 132   1      }
 133          /***********************************************************
 134          * Ãû    ³Æ£º    ÑÓÊ±º¯Êý
 135          * ¹¦    ÄÜ£º
 136          * Èë¿Ú²ÎÊý£º  
 137          * ³ö¿Ú²ÎÊý£º
 138          * Ëµ    Ã÷£º                                     
 139          * µ÷ÓÃ·½·¨£º 
 140          **********************************************************/ 
 141          void Delay200us()               //@22.1184MHz
 142          {
 143   1              unsigned char i, j;
 144   1              _nop_();
 145   1              _nop_();
 146   1              i = 5;
 147   1              j = 73;
 148   1              do
 149   1              {
 150   2                      while (--j);
 151   2              } while (--i);
 152   1      }
 153          
 154          void  delay(unsigned long uldata)
 155          {
 156   1              unsigned int j  =  0;
 157   1              unsigned int g  =  0;
 158   1              while(uldata--)
 159   1              Delay200us();
 160   1      }
 161          
 162          void Delay200ms()               //@22.1184MHz
 163          {
 164   1              unsigned char i, j, k;
 165   1      
 166   1              i = 17;
 167   1              j = 208;
 168   1              k = 27;
 169   1              do
 170   1              {
 171   2                      do
 172   2                      {
 173   3                              while (--k);
 174   3                      } while (--j);
 175   2              } while (--i);
 176   1      }
 177          
 178          /***********************************************************
C51 COMPILER V9.00   MAIN                                                                  11/14/2021 10:30:08 PAGE 4   

 179          * Ãû    ³Æ£º ÖÐ¶Ï´¦Àíº¯Êý
 180          * ¹¦    ÄÜ£º
 181          * Èë¿Ú²ÎÊý£º  
 182          * ³ö¿Ú²ÎÊý£º
 183          * Ëµ    Ã÷£º                                     
 184          * µ÷ÓÃ·½·¨£º 
 185          **********************************************************/ 
 186          void ExtInt0Handler(void) interrupt 0  
 187          {       
 188   1              ProcessInt0();                          
 189   1      }
 190          /***********************************************************
 191          * Ãû    ³Æ£ºÓÃ»§Ö´ÐÐº¯Êý 
 192          * ¹¦    ÄÜ£ºÊ¶±ð³É¹¦ºó£¬Ö´ÐÐ¶¯×÷¿ÉÔÚ´Ë½øÐÐÐÞ¸Ä 
 193          * Èë¿Ú²ÎÊý£º ÎÞ 
 194          * ³ö¿Ú²ÎÊý£ºÎÞ
 195          * Ëµ    Ã÷£º                                     
 196          **********************************************************/
 197          void    User_handle(uint8 dat)
 198          {
 199   1                      PrintCom("\r\nCode: ");
 200   1              //PrintCom(hex(dat));
 201   1                      UARTSendByte(48+dat);//´®¿ÚÊ¶±ðÂë£¨Ê®Áù½øÖÆ£©
 202   1                       if(0==dat)
 203   1                       {
 204   2                              G0_flag=ENABLE;
 205   2                              LED=0;
 206   2                              //SYN_FrameInfo(0, "[v5][m5][t4] ÄãºÃÖ÷ÈË");
 207   2                       }
 208   1                       else if(ENABLE==G0_flag)
 209   1                       {      
 210   2                              G0_flag=DISABLE;
 211   2                              LED=1;
 212   2                              //PrintCom("\nRecogn code: %i.", dat);
 213   2                              //SYN_FrameInfo(0, "[v5][m5][t4] ºÃµÄ");
 214   2                              // v Ç°¾°²¥·ÅÒôÁ¿0-16£¬m ±³¾°ÒôÀÖÒôÁ¿0-16£¬t ´ÊÓïÓïËÙ0-5
 215   2                              switch(dat)                /*¶Ô½á¹ûÖ´ÐÐÏà¹Ø²Ù×÷,¿Í»§¿ÉÉ¾³ýPrintcom ´®¿ÚÊä³öÓï¾äÌæ»»ÎªÆäËûÐèÒª¿ØÖÆµÄ´úÂë*/
 216   2                                {
 217   3                                        case CODE_LUNCH_TIME:                 
 218   3                                      P10=1;                                          
 219   3                                                      SYN_FrameInfo(0, "[v5][m5][t4][o0] ºÃµÄ£¬ÒÑÎªÄã×¼±¸ºÃÁË·áÊ¢µÄÎç²Í£¬ÇëÖ÷ÈËÓÃ²Í¡£");
 220   3                                                      break;
 221   3                                              case CODE_TODAY_WEATHER:        
 222   3                                                      P11=1;
 223   3                                                      SYN_FrameInfo(0, "[v5][m5][t4] ºÃµÄ£¬½ñÌìÇç£¬ÎÂ¶È25¶È£¬·çÁ¦Ò»¶þ¼¶£¬ÊÊºÏÖ÷ÈËÍâ³ö´òÁÔ¡£");
 224   3                                                      break;
 225   3                                              case CODE_TELL_STORY:                   
 226   3                                      P12=1;                                          
 227   3                                                      SYN_FrameInfo(0, "[v5][m5][t4] ºÃµÄ£¬ºÜ¾ÃÒÔÇ°£¬ÔÚ²¨Ë¹Ò»¸ö³ÇÊÐÀï×¡×ÅÁ½ÐÖµÜ£¬ÀÏ´ó½Ð¿¨Ï£ÄÂ£¬ÀÏ¶þ½Ð°¢Àï°
             -Í°Í¡£¿¨Ï£ÄÂ·Ç³£¸»ÓÐ£¬°¢Àï°Í°Í·Ç³£Æ¶À§¡£");
 228   3                                                      break;                                  
 229   3                                              case CODE_PLAY_MUSIC:                   
 230   3                                      P12=1;                                          
 231   3                                                      SYN_FrameInfo(0, "[v5][m10][x1]ringa");
 232   3                                                      break;                                  
 233   3                                              case CODE_BYE:                  
 234   3                                                      P13=1;
 235   3                                                      SYN_FrameInfo(0, "[v5][m5][t4] ºÃµÄÖ÷ÈË£¬Íí°²¡£");
 236   3                                                      break;
 237   3                                              default:
 238   3                                                      SYN_FrameInfo(0, "[v5][m5][t4] Ö÷ÈË£¬ÎÒÃ»ÓÐÌýÇå£¬ÇëÖØ¸´Ö¸Áî");
 239   3                                                      PrintCom("\r\nUnkown command, please try again.");      
C51 COMPILER V9.00   MAIN                                                                  11/14/2021 10:30:08 PAGE 5   

 240   3                                                      break;
 241   3                                      }       
 242   2                              }       
 243   1                              else    
 244   1                              {
 245   2                                      SYN_FrameInfo(0, "[v5][m5][t4] ÇëËµÉñµÆ»ò°¢À­ÉñµÆ»½ÐÑÎÒ¡£");
 246   2                                      PrintCom("\r\nPlease wake me first.");  
 247   2                              }
 248   1      }        


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    419    ----
   CONSTANT SIZE    =    484    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1      10
   IDATA SIZE       =      1       1
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
